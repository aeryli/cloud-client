<!--
Example client that can run in your browser.

Open this page, then open your browser console (usually F12 or Right Click -> Inspect Element)

Use setVariable("☁ variable", "1") to set variables.
Use getVariable("☁ variable") to read variables.
-->
<head>
  <title>Server Client - Scratch Client</title>
  <link rel="shortcut icon" href="https://scratch.mit.edu/favicon.ico">
  <script>var vartoget = "☁ variable"</script>
  <style>
    body {
      font-family: "Helvetica Neue", Helvetica, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background-color: #3498db;
      flex-direction: column;
    }
    .label {
      font-size: 9.45pt;
      font-weight: bold;
      color: #575E75;
      white-space: pre;
    }
    .var {
      display: inline-block;
      background-color: #FF8C1A;
      border-radius: 30px;
      font-size: 16.2pt;
      color: white;
      font-weight: 500;
      padding-top: 14px;
      padding-bottom: 14px;
      padding-left: 16px;
      padding-right: 16px;
      text-decoration: none;
      white-space: pre;
      margin: 5px;
    }
    .text {
      font-size: 81pt;
      color: black;
      font-weight: 750;
      line-height: 0.1;
      color: white;
      -webkit-text-stroke: 2px white;
    }
    .varC {
      font-size: 21pt;
      color: black;
      font-weight: 750;
      line-height: 0.1;
      color: white;
      -webkit-text-stroke: 1px white;
    }
  </style>
</head>
<body>
<p class="varC" id="varC">☁ variable</p>
<p class="text" id="text">1.000</p>
<div>
<button class="var" onclick="vartoget = prompt('Get Variable:');">get variable</button>
<button class="var" onclick="setVariable(vartoget, prompt('Number:'));">set variable</button>
<button class="var" onclick="ws = new WebSocket(prompt('New Server:'));">set server</button>
<button class="var" onclick="usrName = prompt('New Username:');">set username</button>

</div>

<script>
	var ws = new WebSocket('https://scratch-cloud.loca.lt/');
        var usrName = "user"
	var variables = {};
	
	function setVariable(name, value) {
	  console.log(`Setting variable: ${name} = ${value}`);
	  variables[name] = value;
	  ws.send(JSON.stringify({
	    method: "set",
	    name,
	    value
	  }));
	}
	
	function getVariable(name) {
	  return variables[name];
	}
	
	ws.onopen = () => {
	  console.log("Performing handshake");
	
	  // Tell the server which project you want to connect to.
	  ws.send(JSON.stringify({
	    method: "handshake",
	    project_id: "1234567",
	    user: usrName
	  }));
	
	  // To set a variable:
	  // setVariable("☁ variable", "1");
	  vartoget = "☁ variable"

	  // Use setInterval to constantly update a variable
	  setInterval(() => {
	     document.getElementById('text').textContent = getVariable(vartoget);
         document.getElementById('varC').textContent = vartoget;
	  }, 100);
	};
	
	ws.onmessage = (event) => {
	  // Process updates from the server.
	  for (const message of event.data.split("\n")) {
	    const obj = JSON.parse(message);
	    if (obj.method === "set") {
	      variables[obj.name] = obj.value;
	      console.log(`Server set variable: ${obj.name} = ${obj.value}`);
	    }
	  }
	};
	
	ws.onclose = () => {
	  console.log("Server closed connection");
	};
	
	ws.onerror = () => {
	  console.log("error!");
	  document.getElementById('text').textContent = 'error';
	};

</script>
</body>
